<!DOCTYPE html>
  <meta charset="utf-8">
  <head>
    <link href="styles/styles.css" rel="stylesheet">
    <div style="text-align: center;">
      <h1> Electric cars registered in Iceland, Norway and the United Kingdom </h1>
      <h2> Switching to electric cars is becoming a trend  </h2>
    </div>
  </head>
  <!-- Load d3.js -->
  <script src="https://d3js.org/d3.v4.js"></script>

  <!-- Create a div where the graph will take place -->
  <div id="my_dataviz"></div>

  <script>

      // set the dimensions and margins of the graph
      var margin = {top: 10, right: 30, bottom: 30, left: 60},
          width = 1000 - margin.left - margin.right,
          height = 600 - margin.top - margin.bottom;
      
      // append the svg object to the body of the page
      var svg = d3.select("#my_dataviz")
        .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");
      
      //Read the data
      d3.csv("https://raw.githubusercontent.com/GordonHuy/Data_Visualization_Project/master/Datasets/Electric%20cars%20registered%20in%20Iceland%2C%20Norway%20and%20the%20United%20Kingdom.csv",
      
        // When reading the csv, I must format variables:
        function(d){
          return { year: d['Year:year'], date : new Date(+d['Year:year'], 0, 1), value : d['Share of electric cars in new registrations [%]:number']}
        },
      
        // Now I can use this dataset:
        function(data) {
          console.log(data);

          var nested = d3.nest()
                          .key(function (d) { return d3.timeFormat('%Y')(d.date); })
                          .rollup(function(leaves){
                              return d3.sum(leaves, function(d){
                                  return d.value;
                              });
                          }).entries(data);
          console.log(nested);

          // Add X axis --> it is a date format
          var x = d3.scaleTime()
            .domain(d3.extent(nested, function(d) { return d.key; }))
            .range([ 0, width ]);
          svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x));
      
          // Add Y axis
          var y = d3.scaleLinear()
            .domain([0, d3.max(nested, function(d) { return +d.value; })])
            .range([ height, 0 ]);
          svg.append("g")
            .call(d3.axisLeft(y));
      
          // Add the line
          svg.append("path")
            .datum(nested)
            .attr("fill", "none")
            .attr("stroke", "steelblue")
            .attr("stroke-width", 1.5)
            .attr("d", d3.line()
              .x(function(d) { return x(d.key) })
              .y(function(d) { return y(d.value) })
              );
          
          svg.selectAll('.temp-circle')
            .data(nested)
            .enter()
            .append('circle')
            .attr('class', 'temp-circle')
            .attr('r', 5 + 'px')
            .attr('cx', (d) => x(d.key))
            .attr('cy', (d) => y(d.value))
            .attr("fill", "red")
            .on("mouseover", function(d) {
                d3.select(this)
                    .attr("fill", "yellow")
                    .attr("opacity", 0.75);
                var xPosition = parseFloat(d3.select(this).attr("cx")) + width / 7;
                var yPosition = parseFloat(d3.select(this).attr("cy") / 2 + height / 2);

                d3.select("#tooltip")
                    .style("left", xPosition + "px")
                    .style("top", yPosition + "px")
                    .select("#value")
                    .text(d.key + "_ Percentage: " + d.value);
                
                d3.select("#tooltip").classed("hidden", false);
            })
            .on("mouseout", function(d) {
                d3.select(this)
                    .transition()
                    .duration(400)
                    .attr("fill", "red")
                    .attr("opacity", 1);
                d3.select("#tooltip").classed("hidden", true);
            });


      })
    
    </script>